<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Real solution · Filtration</title><meta name="title" content="Real solution · Filtration"/><meta property="og:title" content="Real solution · Filtration"/><meta property="twitter:title" content="Real solution · Filtration"/><meta name="description" content="Documentation for Filtration."/><meta property="og:description" content="Documentation for Filtration."/><meta property="twitter:description" content="Documentation for Filtration."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Filtration</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><a class="tocitem" href="basic-usage.html">Basic Usage</a></li><li><a class="tocitem" href="examples.html">Examples</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="model.html">Model</a></li><li><a class="tocitem" href="solution.html">Solution</a></li><li class="is-active"><a class="tocitem" href="real_solve.html">Real solution</a><ul class="internal"><li><a class="tocitem" href="#Method-1-:-Control-approximation"><span>Method 1 : Control approximation</span></a></li><li><a class="tocitem" href="#Method-2-:-Singular-state-approximation"><span>Method 2 : Singular state approximation</span></a></li><li><a class="tocitem" href="#Method-3-:-Optimal-real-solution"><span>Method 3 : Optimal real solution</span></a></li><li><a class="tocitem" href="#Comparison"><span>Comparison</span></a></li></ul></li><li><a class="tocitem" href="fit.html">Fit data</a></li></ul></li><li><a class="tocitem" href="multisynthesis.html">Experimental</a></li><li><a class="tocitem" href="2Res_CT.html">Control-Toolbox</a></li><li><a class="tocitem" href="api-filtration.html">API</a></li><li><a class="tocitem" href="dev-filtration.html">Developpers</a></li><li><a class="tocitem" href="references.html">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href="real_solve.html">Real solution</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="real_solve.html">Real solution</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/remydutto/doc-Filtration.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="From-optimal-solution-to-real-solution"><a class="docs-heading-anchor" href="#From-optimal-solution-to-real-solution">From optimal solution to real solution</a><a id="From-optimal-solution-to-real-solution-1"></a><a class="docs-heading-anchor-permalink" href="#From-optimal-solution-to-real-solution" title="Permalink"></a></h1><p>The goal is now to present how we can approximate an optimal solution to a real control, in which the control can only take the values <span>$-1$</span> or <span>$1$</span>. </p><p>To do this, let first define a model </p><pre><code class="language-julia hljs">using Filtration
using Plots

vlim = (0,200); mlim = (0,100)
ap = 0; bp = 1; cp = 0.16; dp = 3; Qp = 1
ar = 0.5; cr = 0.64; dr = 12; Qr = 2
p = [ap, bp, cp, dp, Qp, ar, cr, dr, Qr]

f₁(m,p) = -p[1]*m + p[2]
f₂(m,p) = -p[6]*m
g₁(m,p) = p[5]
g₂(m,p) = -p[9]
e₁(m,p) = p[3]*m + p[4]
e₂(m,p) = p[7]*m + p[8]

model = Model(e₁, e₂, f₁, f₂, g₁, g₂, p, :min; initial_guess = 15.)

synthesis = Synthesis(model, vlim, mlim)
plt_synthesis = plot(synthesis, xlabel = &quot;Volume (v)&quot;, ylabel = &quot;Mass (m)&quot;, legend = :topleft)</code></pre><img src="real_solve-d11996f1.svg" alt="Example block output"/><p>Let fix for instance <span>$x_1(t_0) = m_0 = 40$</span> and <span>$x_2(t_0) = v_0 = 5$</span>, and compute the solution of the problem. </p><pre><code class="language-julia hljs">v0 = 5; m0 = 40.
sol = solution(synthesis, v0, vlim[2], m0)
plot(sol, label = &quot;optimal &quot;)</code></pre><img src="real_solve-79277e92.svg" alt="Example block output"/><pre><code class="language-julia hljs">add_solution_to_synthesis!(plt_synthesis, sol, axis_arrow = :x, label = &quot;optimal &quot;)</code></pre><img src="real_solve-1f91ccf9.svg" alt="Example block output"/><p>As we can see, the control <span>$u(\cdot)$</span> on the singular arc take a value between <span>$-1$</span> and <span>$1$</span>, which is not really applicable on a real membrane. We propose three method to provide a real control solution. For all these method, we need to fix a number <span>$N$</span> of swiching, which will be in this example fixed to <span>$N = 5$</span></p><pre><code class="language-julia hljs">N = 5;
nothing; #hide</code></pre><h2 id="Method-1-:-Control-approximation"><a class="docs-heading-anchor" href="#Method-1-:-Control-approximation">Method 1 : Control approximation</a><a id="Method-1-:-Control-approximation-1"></a><a class="docs-heading-anchor-permalink" href="#Method-1-:-Control-approximation" title="Permalink"></a></h2><p>The first method, named <code>:control</code>, approximate the singular control <span>$u(\cdot) = u_s$</span> by <span>$-1$</span> and <span>$1$</span> value on each subsegments. </p><p>Let assume that the optimal solution have a singular arc on <span>$[T_1, T_2]$</span>. This interval of time is divised by <span>$N$</span> subintervals of time <span>$\Delta_i = [t_i, t_{i+1}]$</span> where <span>$i \in \{ 1, ... , N \}$</span> and where  </p><p class="math-container">\[t_i = T_1 + (i-1) * \Delta t, \quad \Delta t = \frac{T_2 - T_1}{N}\]</p><p>On each subintervals of time <span>$\Delta_i$</span>, the time spend with <span>$u = +1$</span> with respect to the time spend with <span>$u = -1$</span> is proportional to the value of the singular control <span>$u_s$</span> in <span>$[-1, 1]$</span>. In other words, the (real) control <span>$u(\cdot)$</span> is defined for all <span>$i \in \{ 1, ... , N \}$</span> on the singular arc by </p><p class="math-container">\[u(t) = \left \{ \begin{array}{ll} 
    +1 &amp; \quad \forall t \in [t_i, t_i + \delta t] \\
    -1 &amp; \quad \forall t \in [t_i + \delta t, t_{i+1}]
\end{array} \right.
\quad \text{ where } \quad \delta t = \Delta t  \frac{u_s + 1}{2}.  \]</p><p>This following code shows the results of this method. </p><pre><code class="language-julia hljs">real_sol₁ = real_solve(model, v0, vlim[2], m0, N, method = :control)
plt_solution = plot(sol, label = &quot;optimal &quot;)
plot!(plt_solution, real_sol₁, label = &quot;:control &quot;, color = :blue)</code></pre><img src="real_solve-c7e17888.svg" alt="Example block output"/><pre><code class="language-julia hljs">plt_synthesis = plot(synthesis, xlabel = &quot;Volume (v)&quot;, ylabel = &quot;Mass (m)&quot;, legend = :topleft)
add_solution_to_synthesis!(plt_synthesis, sol, axis_arrow = :x, label = &quot;optimal &quot;, linewidth = 2)
add_solution_to_synthesis!(plt_synthesis, real_sol₁, axis_arrow = :x, color = :blue, label = &quot;:control &quot;)</code></pre><img src="real_solve-0e066666.svg" alt="Example block output"/><h2 id="Method-2-:-Singular-state-approximation"><a class="docs-heading-anchor" href="#Method-2-:-Singular-state-approximation">Method 2 : Singular state approximation</a><a id="Method-2-:-Singular-state-approximation-1"></a><a class="docs-heading-anchor-permalink" href="#Method-2-:-Singular-state-approximation" title="Permalink"></a></h2><p>The second method, named <code>:singular</code>, is based on the singular arc approximation. The main idea is to subdivise the singular arc intro <span>$N$</span> subsegments and to find the optimal control of structure <span>$u_+ \circ u_- \circ u_+$</span> that minimise the energy and that satisfy that the final state (on <span>$x_1$</span> and <span>$x_2$</span>) corresponds to the one of the end of the subsegments of the singular arc defined above. </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Here we use the fact that the problem is autonomous, and therefore we just have to solve a small optimization problem to define the whole trajecotry of state. </p></div></div><p>Denoting <span>$T_1$</span> the begining time of the singular arc, the singular control is defined for all <span>$i \in \{ 1, ... N \}$</span> by </p><p class="math-container">\[u(t) = \left \{ \begin{array}{ll} 
    +1 &amp; \quad \forall t \in [T_1 + (i-1) \delta t_3, T_1 + (i-1) \delta t_3 + \delta t_1] \\
    -1 &amp; \quad \forall t \in [T_1 + (i-1) \delta t_3 + \delta t_1, T_1 + (i-1) \delta t_3 + \delta t_2] \\
    +1 &amp; \quad \forall t \in [T_1 + (i-1) \delta t_3 + \delta t_2, T_1 + i \delta t_3]
\end{array} \right.\]</p><p>where <span>$\delta t_1$</span>, <span>$\delta t_2$</span> and <span>$\delta t_3$</span> are solution of the following optimization problem </p><p class="math-container">\[\left \{ \begin{array}{l}
    \min_{\delta t_1, \delta t_2, \delta t_3} \phi_0^{+-+}(\delta t_1, \delta t_2, \delta t_3) \\
    \textrm{s.t. } \phi_1^{+-+}(\delta t_1, \delta t_2, \delta t_3) = x_s \\
    \phantom{\textrm{s.t. }} \phi_2^{+-+}(\delta t_1, \delta t_2, \delta t_3) = \delta x_2
\end{array}\right.\]</p><p>where <span>$\phi_k^{+-+}$</span> corresponds to the value of the final state <span>$k$</span> (<span>$0$</span> for the cost) by applying the control <span>$+1$</span> on <span>$[0, \delta t_1]$</span>, the control <span>$-1$</span> on <span>$[\delta t_1, \delta t_2]$</span> and the control <span>$+1$</span> on <span>$[\delta t_2, \delta t_3]$</span>. The value <span>$\delta x_2$</span> is computed by the subdivision of the singular arc and <span>$x_s$</span> corresponds to the value of the singular state. </p><p>Here is the result for this method </p><pre><code class="language-julia hljs">real_sol₂ = real_solve(model, v0, vlim[2], m0, N, method = :singular)

plt_solution = plot(sol, label = &quot;optimal &quot;)
plot!(plt_solution, real_sol₂, label = &quot;:singular &quot;, color = :red)</code></pre><img src="real_solve-b55afe84.svg" alt="Example block output"/><pre><code class="language-julia hljs">plt_synthesis = plot(synthesis, xlabel = &quot;Volume (v)&quot;, ylabel = &quot;Mass (m)&quot;, legend = :topleft)
add_solution_to_synthesis!(plt_synthesis, sol, axis_arrow = :x, label = &quot;optimal &quot;, linewidth = 2)
add_solution_to_synthesis!(plt_synthesis, real_sol₂, axis_arrow = :x, color = :red, label = &quot;:singular &quot;)</code></pre><img src="real_solve-96b3b46f.svg" alt="Example block output"/><h2 id="Method-3-:-Optimal-real-solution"><a class="docs-heading-anchor" href="#Method-3-:-Optimal-real-solution">Method 3 : Optimal real solution</a><a id="Method-3-:-Optimal-real-solution-1"></a><a class="docs-heading-anchor-permalink" href="#Method-3-:-Optimal-real-solution" title="Permalink"></a></h2><p>The third method computes the real optimal real solution of the problem. Here we define the large optimization problem which consists to find the values of the switching time which minimize the cost and satisfy the boundary conditions. </p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>This method could not be used if <span>$N$</span> is large, due to the computation time. </p></div></div><p>Here the code to obtain the optimal real solution </p><pre><code class="language-julia hljs">real_sol₃ = real_solve(model, v0, vlim[2], m0, N, method = :optimal)

plt_solution = plot(sol, label = &quot;optimal &quot;)
plot!(plt_solution, real_sol₃, label = &quot;:optimal &quot;, color = :green)</code></pre><img src="real_solve-fa08556f.svg" alt="Example block output"/><pre><code class="language-julia hljs">plt_synthesis = plot(synthesis, xlabel = &quot;Volume (v)&quot;, ylabel = &quot;Mass (m)&quot;, legend = :topleft)
add_solution_to_synthesis!(plt_synthesis, sol, axis_arrow = :x, label = &quot;optimal &quot;, linewidth = 2)
add_solution_to_synthesis!(plt_synthesis, real_sol₃, axis_arrow = :x, color = :green, label = &quot;:optimal &quot;)</code></pre><img src="real_solve-0ce0415b.svg" alt="Example block output"/><h2 id="Comparison"><a class="docs-heading-anchor" href="#Comparison">Comparison</a><a id="Comparison-1"></a><a class="docs-heading-anchor-permalink" href="#Comparison" title="Permalink"></a></h2><p>We compare these three methods in terms of optimality and computation time. </p><img src="https://github.com/remydutto/doc-Filtration.jl/blob/main/ressources/plots/computation_real_control.png?raw=true" style="display: block; margin-left: auto; margin-right: auto;" width="600px">
<br></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="solution.html">« Solution</a><a class="docs-footer-nextpage" href="fit.html">Fit data »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Friday 4 July 2025 16:22">Friday 4 July 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
