<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic Example · Filtration</title><meta name="title" content="Basic Example · Filtration"/><meta property="og:title" content="Basic Example · Filtration"/><meta property="twitter:title" content="Basic Example · Filtration"/><meta name="description" content="Documentation for Filtration."/><meta property="og:description" content="Documentation for Filtration."/><meta property="twitter:description" content="Documentation for Filtration."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Filtration</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li class="is-active"><a class="tocitem" href="basic-example.html">Basic Example</a><ul class="internal"><li><a class="tocitem" href="#Model-definition"><span>Model definition</span></a></li><li><a class="tocitem" href="#Verification-of-hypotheses"><span>Verification of hypotheses</span></a></li><li><a class="tocitem" href="#Direct-Solve"><span>Direct Solve</span></a></li><li><a class="tocitem" href="#Indirect-solve-and-optimal-synthesis"><span>Indirect solve &amp; optimal synthesis</span></a></li></ul></li><li><a class="tocitem" href="examples.html">Examples</a></li><li><a class="tocitem" href="api-filtration.html">API</a></li><li><a class="tocitem" href="dev-filtration.html">Developpers</a></li><li><a class="tocitem" href="references.html">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="basic-example.html">Basic Example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="basic-example.html">Basic Example</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/remydutto/doc-Filtration.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Membrane-Filtration-:-Direct-solve"><a class="docs-heading-anchor" href="#Membrane-Filtration-:-Direct-solve">Membrane Filtration : Direct solve</a><a id="Membrane-Filtration-:-Direct-solve-1"></a><a class="docs-heading-anchor-permalink" href="#Membrane-Filtration-:-Direct-solve" title="Permalink"></a></h1><p>Let us consider the membrane filtration process where the goal is to maximize the water net production </p><p class="math-container">\[    \max_{x(\cdot), u(\cdot)} \int_{0}^{T} u(t) g\big( m(t) \big) \mathrm dt, \]</p><p>where the control <span>$u(\cdot) \in \mathrm L^\infty([0,T], \mathbb R)$</span> corresponds to the filtration mode (1 during filtration and -1 during backwash) and the state <span>$m (\cdot) \in \mathrm{AC}([0, T], \mathbb R)$</span> is the mass of the cake layer formed during the water filtration. The dynamic of this state is given by </p><p class="math-container">\[    \dot m(t) = \frac{1 + u(t)}{2} f_1(m(t)) - \frac{1 - u(t)}{2} f_2(m(t))\]</p><p>with the initial condition <span>$m(0) = m_0$</span>. </p><p>Based on [<a href="https://doi.org/10.1016/j.ifacol.2017.08.1554">Kalboussi et al., 2018</a>], we assume that <span>$f_1$</span> and <span>$g$</span> are smooth <span>$\mathcal L$</span>-function, and that <span>$f_2$</span> is a smooth <span>$\mathcal K$</span> function. </p><p>First, we need to have the Filtration.jl package. To solve problems by indirect methods, we use <a href="https://control-toolbox.org/OptimalControl.jl">OptimalControl.jl</a> package and <a href="https://madnlp.github.io/MadNLP.jl">MadNLP.jl</a>.  We will also need to import the <a href="https://docs.juliaplots.org">Plots.jl</a> package.</p><pre><code class="language-julia hljs">using Filtration
using OptimalControl
using Plots
using MadNLP</code></pre><h2 id="Model-definition"><a class="docs-heading-anchor" href="#Model-definition">Model definition</a><a id="Model-definition-1"></a><a class="docs-heading-anchor-permalink" href="#Model-definition" title="Permalink"></a></h2><p>In this example, these functions are defined by using the [<a href="https://www.researchgate.net/publication/272506325_A_simple_model_of_anaerobic_membrane_bioreactor_for_control_design_coupling_the_AM2b_model_with_a_simple_membrane_fouling_dynamics">Benyahia et al., 2013</a>] model : </p><p class="math-container">\[f_1(m) = \frac{b}{e+m}, \quad f_2(m) = am, \quad g(m) = \frac{1}{e+m}, \]</p><p>where <span>$a$</span>, <span>$b$</span> and <span>$e$</span> are positive numbers. The problem is simply defined, thanks to <code>MembraneFiltrationModel</code>.</p><pre><code class="language-julia hljs"># Benyahia &amp; al. model
a = 1; b = 1; e = 1;
f₁ = m -&gt;  b ./ (e .+ m)
f₂ = m -&gt; a .* m
g  = m -&gt; 1 ./ (e .+ m)
model = MembraneFiltrationModel(f₁, f₂, g)</code></pre><h2 id="Verification-of-hypotheses"><a class="docs-heading-anchor" href="#Verification-of-hypotheses">Verification of hypotheses</a><a id="Verification-of-hypotheses-1"></a><a class="docs-heading-anchor-permalink" href="#Verification-of-hypotheses" title="Permalink"></a></h2><p>With this model, we know that the function <span>$\psi$</span> defined by </p><p class="math-container">\[\psi(m) = g(m)\big[f_{-}&#39;(m) f_{+}(m) - f_{-}(m) f_{+}&#39;(m)\big] + g&#39;(m) f_+(m) f_-(m)\]</p><p>have an unique positive root, denoted <span>$m_s$</span>, where function <span>$f_+$</span> and <span>$f_-$</span> are given by </p><p class="math-container">\[f_+(m) = \frac{f_1(m) + f_2(m)}{2} \quad \text{and} \quad f_-(m) = \frac{f_1(m) -f_2(m)}{2} \cdot\]</p><p>For more information about why this property is needed, please refer to [<a href="https://doi.org/10.1016/j.ifacol.2017.08.1554">Kalboussi et al., 2018</a>]. However, we can take a look on this function <span>$\psi$</span>. </p><pre><code class="language-julia hljs">ylim = (0,10)
ψ = model.ψ
mₛ = model.mₛ
plot(range(ylim[1], ylim[2], 100), ψ, label = &quot;ψ&quot;)
scatter!([mₛ], [ψ(mₛ)], label = &quot;mₛ&quot;)</code></pre><img src="basic-example-c85858ac.svg" alt="Example block output"/><h2 id="Direct-Solve"><a class="docs-heading-anchor" href="#Direct-Solve">Direct Solve</a><a id="Direct-Solve-1"></a><a class="docs-heading-anchor-permalink" href="#Direct-Solve" title="Permalink"></a></h2><p>We can solve the optimal control problem by derect method, thanks to the <a href="https://control-toolbox.org/OptimalControl.jl">OptimalControl.jl</a> package.</p><pre><code class="language-julia hljs">t0 = 0; m0 = 1; tf = 10;                # initial and final time and state
@def ocp begin                          # problem definition
    t ∈ [ t0, tf ], time
    m ∈ R, state
    u ∈ R, control
    -1 ≤ u(t) ≤ 1
    m(t0) == m0
    ṁ(t) == model.state_dynamic(m(t),u(t))
    ∫( model.cost_dynamic(m(t),u(t))) → max
end
sol = OptimalControl.solve(ocp, :madnlp)
plot(sol)</code></pre><img src="basic-example-c5342b0c.svg" alt="Example block output"/><h2 id="Indirect-solve-and-optimal-synthesis"><a class="docs-heading-anchor" href="#Indirect-solve-and-optimal-synthesis">Indirect solve &amp; optimal synthesis</a><a id="Indirect-solve-and-optimal-synthesis-1"></a><a class="docs-heading-anchor-permalink" href="#Indirect-solve-and-optimal-synthesis" title="Permalink"></a></h2><p>This package develops a code to solve this kind of optimal control problem by indirect methods. Compared to direct method, indirect shooting are known to be more precise and faster. However, to achieve this goal, the sructure of the control need to be konwn beforehand. This step is automaticaly done with the initial time <span>$t_0$</span>, the final time <span>$t_f$</span> and the initial state <span>$m_0$</span>.</p><p>After that, the optimal state and cost trajectory is computed without finding a zero of shooting function. To do this propely, we use the <code>ContinuousCallback</code> fonctionality of the <a href="https://docs.sciml.ai/OrdinaryDiffEq/stable/">OrdinaryDiffEq.jl</a> package to detect when the control changes. For more information, <a href="https://docs.sciml.ai/DiffEqDocs/stable/features/callback_functions/">see this documentation page</a></p><p>The output of the <code>indirect_solve</code> function is an <code>ODESolution</code>. The timestep <span>$t$</span>, the state <span>$m$</span> and the associated cost <span>$m^0$</span> can be obtained via the following code</p><pre><code class="language-julia hljs">sol = indirect_solve(model, t0, tf, m0)
t = sol.t
m = [sol.u[i][2] for i in 1:length(sol.u)]
m⁰ = [sol.u[i][1] for i in 1:length(sol.u)]
plot(t, [m, m⁰], layout = [2], size=(600, 300), xlabel = &quot;time (t)&quot;, labels = nothing, title=[&quot;State m&quot; &quot;Cost m⁰&quot;])</code></pre><img src="basic-example-8492bda1.svg" alt="Example block output"/><p>The optimal systhesis of this problem can be easily plot, thanks to the <code>optimal_synthesis</code> function.</p><pre><code class="language-julia hljs">plt = optimal_synthesis(model, t0, tf; ylim = ylim)</code></pre><img src="basic-example-66c52fc1.svg" alt="Example block output"/><p>We can easily add some optimal state trajectories on the optimal synthesis plot.</p><pre><code class="language-julia hljs">for m0 ∈ range(ylim[1],ylim[2])
    sol = indirect_solve(model, t0, tf, m0)
    t = sol.t
    m  = [sol.u[i][2] for i in 1:length(sol.u)]
    plot!(plt, t, m, color = :Gray, label = &quot;&quot;)
end
for t0_ ∈ range(t0,tf)
    sol = indirect_solve(model, t0_, tf, ylim[1])
    t = sol.t
    m  = [sol.u[i][2] for i in 1:length(sol.u)]
    plot!(plt, t, m, color = :Gray, label = &quot;&quot;)
    sol = indirect_solve(model, t0_, tf, ylim[2])
    t = sol.t
    m  = [sol.u[i][2] for i in 1:length(sol.u)]
    plot!(plt, t, m, color = :Gray, label = &quot;&quot;)
end
plt</code></pre><img src="basic-example-99cce79e.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« Introduction</a><a class="docs-footer-nextpage" href="examples.html">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Saturday 22 February 2025 13:52">Saturday 22 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
